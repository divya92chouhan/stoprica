= form_for @racer do |f|
  - if @racer.errors.any?
    #error_explanation
      %h2= "#{pluralize(@racer.errors.count, "error")} prohibited this racer from being saved:"
      %ul
        - @racer.errors.full_messages.each do |msg|
          %li= msg

  .field
    .mdl-textfield.mdl-js-textfield
      %input#email.mdl-textfield__input{type: 'email', name: 'racer[email]', required: true, value: @racer.email}
      %label.mdl-textfield__label{for: 'email'} Email

  .field
    .mdl-textfield.mdl-js-textfield
      %input#first_name.mdl-textfield__input{type: 'text', name: 'racer[first_name]', required: true, value: @racer.first_name}
      %label.mdl-textfield__label{for: 'first_name'} Ime
  .field
    .mdl-textfield.mdl-js-textfield
      %input#last_name.mdl-textfield__input{type: 'text', name: 'racer[last_name]', required: true, value: @racer.last_name}
      %label.mdl-textfield__label{for: 'last_name'} Prezime
  .field
    .mdl-textfield.mdl-js-textfield{ style: 'width: 60px; margin-right: 20px;' }
      %input#day_of_birth.mdl-textfield__input{pattern: "-?[0-9]*(\\.[0-9]+)?", type: 'text', name: 'racer[day_of_birth]', required: true, value: @racer.day_of_birth}
      %label.mdl-textfield__label{for: 'day_of_birth'} Dan
      %span.mdl-textfield__error Unesi broj!
    .mdl-textfield.mdl-js-textfield{ style: 'width: 60px; margin-right: 20px;' }
      %input#month_of_birth.mdl-textfield__input{pattern: "-?[0-9]*(\\.[0-9]+)?", type: 'text', name: 'racer[month_of_birth]', required: true, value: @racer.month_of_birth}
      %label.mdl-textfield__label{for: 'month_of_birth'} Mjesec
      %span.mdl-textfield__error Unesi broj!
    .mdl-textfield.mdl-js-textfield{ style: 'width: 140px;' }
      %input#year_of_birth.mdl-textfield__input{pattern: "-?[0-9]*(\\.[0-9]+)?", type: 'text', name: 'racer[year_of_birth]', required: true, value: @racer.year_of_birth}
      %label.mdl-textfield__label{for: 'year_of_birth'} Godina rodenja
      %span.mdl-textfield__error Unesi broj!
  %br
  .field
    %label.mdl-radio.mdl-js-radio.mdl-js-ripple-effect{:for => 'spol-zenski'}
      %input#spol-zenski.mdl-radio__button{name: 'racer[gender]', :type => "radio", value: 1, required: true, checked: @racer.gender == 1}
      %span.mdl-radio__label Zensko

    %label.mdl-radio.mdl-js-radio.mdl-js-ripple-effect{:for => 'spol-muski'}
      %input#spol-muski.mdl-radio__button{name: 'racer[gender]', type: 'radio', value: 2, required: true, checked: @racer.gender == 2}
      %span.mdl-radio__label Musko

  .field
    .mdl-textfield
      %select{ name: 'racer[shirt_size]' }
        %option{ disabled: true, selected: @racer.shirt_size.nil?, value: 0 }
          Velicina majice
        - %w(S M L XL XXL XXXL).each do |size|
          %option{ value: size, selected: @racer.shirt_size == size }
            = size
  .field
    .mdl-textfield.mdl-js-textfield
      %input#personal_best.mdl-textfield__input{type: 'text', name: 'racer[personal_best]', value: @racer.personal_best, pattern: "[0-9]{1,2}:[0-9]{1,2}:[0-9]{1,2}", title: "Please use hh:mm:ss format for your perosnal best!"}
      %label.mdl-textfield__label{for: 'personal_best'} Personal Best 21.1 km

  .field
    .mdl-textfield.mdl-js-textfield
      %input#phone_number.mdl-textfield__input{pattern: "-?[0-9]*(\\.[0-9]+)?", type: 'text', name: 'racer[phone_number]', required: true, value: @racer.phone_number}
      %label.mdl-textfield__label{for: 'phone_number'} Broj mobitela
      %span.mdl-textfield__error Unesi ispravan broj u formatu 385911234567!
  .field
    .mdl-textfield.mdl-js-textfield
      %input#address.mdl-textfield__input{type: 'text', name: 'racer[address]', value: @racer.address}
      %label.mdl-textfield__label{for: 'address'} Adresa
  .field
    .mdl-textfield.mdl-js-textfield{ style: 'width: 105px; margin-right: 20px;' }
      %input#zip_code.mdl-textfield__input{type: 'text', name: 'racer[zip_code]', value: @racer.zip_code}
      %label.mdl-textfield__label{for: 'zip_code'} Postanski broj
    .mdl-textfield.mdl-js-textfield{ style: 'width: 175px' }
      %input#town.mdl-textfield__input{type: 'text', name: 'racer[town]', required: true, value: @racer.town}
      %label.mdl-textfield__label{for: 'town'} Mjesto stanovanja
  .field
    .mdl-textfield.mdl-js-textfield
      = f.country_select :country, priority_countries: ['HR', 'BA', 'SI', 'HU', 'CZ']
  .field
    .mdl-textfield.mdl-js-textfield
      %input#uci_id.mdl-textfield__input{type: 'text', name: 'racer[uci_id]', value: @racer.uci_id}
      %label.mdl-textfield__label{for: 'uci_id'} UCI ID
  .field
    .mdl-textfield
      %select#category_select.is-capitalized{ name: 'racer[club_id]' }
        %option{ disabled: true, value: nil, selected: true}
          Kategorija kluba
        - Club.categories.each do |category|
          %option.is-capitalized{ value: category[0], selected: @racer.club&.category == category }
            = category[0]

  .field
    .mdl-textfield
      %select#club_select{ name: 'racer[club_id]' }
        %option{ disabled: true, selected: @racer.club.nil? }
          Klub
        - Club.all.each do |club|
          %option{ value: club.id, selected: @racer.club.try(:id) == club.id, data: { category: club.category } }
            = club.name

  - if user_signed_in? && current_user.admin?
    .field
      %label Skriven
      = f.check_box :hidden

  - unless @racer.id || (user_signed_in? && current_user.admin?)
    .field
      = recaptcha_tags

  - unless @racer.id
    .field
      %label.mdl-checkbox.mdl-js-checkbox.mdl-js-ripple-effect{for: 'accept_terms'}
        %input#accept_terms.mdl-checkbox__input{type: 'checkbox', required: true}
        %span.mdl-checkbox__label
          Ovim prihvaÄ‡am
          %a{href: '/terms', target: '_blank'}
            Izjavu o koristenju podataka
  %hr

  .actions
    = f.submit 'Spremi', class: 'mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent', style: 'color: white;'

:javascript
  var categorySelect = document.querySelector('#category_select');
  var clubSelect = document.querySelector('#club_select');
  var options = clubSelect.options;
  var optionsValues = [];
  for(var i = 1; i < options.length; i++) {
    optionsValues.push(options[i]);
  }
  options.length = 1;

  categorySelect.addEventListener('change', function(event){
    var category = event.target.value;
    var filteredOptions = [];
    options.length = 1;

    for(var i = 0; i < optionsValues.length; i++) {
      var option = optionsValues[i];
      if (option.dataset.category === category) {
        filteredOptions.push(option);
      }
    }

    for(var i = 0; i < filteredOptions.length; i++) {
      options.add(filteredOptions[i]);
    }
  });

